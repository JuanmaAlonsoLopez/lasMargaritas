<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../images/logoBanner/logo.png" type="image/png">
    <title>Resumen de Compra</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../style/product.css">
    <link rel="stylesheet" href="../style/nuevo/nav-footer.css">
    <link rel="stylesheet" href="../style/carrito.css">
    <link rel="stylesheet" href="../style/ResCompra.css">
</head>

<body>

    <header id="mainHeader">
        <div class="header-inner">
            <div class="logo" id="logo">
                <a href="../index.html">
                    <img src="../images/logoBanner/logoMargasNuevo.png" alt="Logo Las Margaritas">
                </a>
            </div>
            <nav class="main-nav" id="mainNav">
                <a href="../index.html">Inicio</a>
                <a class="activo" href="../pages/listadoProductos.html">Productos</a>
                <a href="../pages/sobreNosotros.html">Sobre nosotros</a>
                <a href="../pages/contacto.html">Contacto</a>
            </nav>
            <div class="icons" id="icons">
                <a href="#">
                    <img src="../images/logoBanner/account_circle_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg" alt="Ingresar">
                </a>
                <a href="../pages/carrito.html">
                    <img src="../images/logoBanner/shopping-cart_icon-icons.com_72552.svg" alt="Carrito">
                </a>
            </div>
        </div>
    </header>

    <div class="menu-hamburguesa-btn" id="btnHamburguesa" aria-label="Abrir menú">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <nav class="menu-hamburguesa" id="menuHamburguesaResponsive">
        <a href="index.html">INICIO</a>
        <a href="./pages/categorias.html">CATEGORÍAS</a>
        <a href="./pages/listadoProductos.html">LISTADO DE PRODUCTOS</a>
        <a href="./pages/sobreNosotros.html">SOBRE NOSOTROS</a>
        <a href="./pages/contacto.html">CONTACTO</a>
    </nav>

    <div class="container">
        <div class="left-container">
            <div id="cart-products-container">
                </div>

            <div class="envio">
                <span class="envio-text">Envío</span>
                <div class="barra-envio">
                    <span>Agrega $1,500 más para conseguir envío gratis en productos de Almohadones Ortopédicos.</span>
                </div>
            </div>
            <div class="productos-relacionados">
                <span>Ver más productos de este vendedor</span>
            </div>
        </div>

        <div class="right-container">
            <div class="resumen-compra">
                <h3>Resumen de compra</h3>
                <div class="detalles">
                    <p id="product-subtotal">Producto: $0.00</p>
                    <p id="shipping-cost">Envío: $1,500.00</p>
                    <p id="total-amount">Total: $0.00</p>
                </div>
                <button id="comprar" class="continuar-compra">Continuar compra</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-grid">
            <div class="footer-right">
                <img src="../images/logoBanner/logoMargasNuevo.png" alt="Logo Las Margaritas" class="footer-logo">
                <p class="footer-desc">Fabrica de productos de confort</p>
                <a href="#" class="footer-social">
                    <div class="socialMedia">
                        <a href="https://www.instagram.com/almohadones.lasmargaritas">
                            <img src="../images/logotipo-de-instagram.png" alt="Instagram">
                        </a>
                    </div>
                </a>
            </div>
            <div class="footer-center">
                <span>Avda. Juan B. Justo 8667</span>
                <span>CABA, Argentina</span>
                <span>telefono: 11 3437-4127</span>
                <span>Email: info@lasmargaritas.online</span>
            </div>
            <div class="footer-left">
                <a href=""><span>Contacto</span></a>
                <a href=""><span>Sobre Nosotros</span></a>
                <a href=""><span>Otro</span></a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Todos los derechos reservados @ Las Margaritas 2025</p>
        </div>
    </footer>

    <script src="../js/navbar.js"></script>
    <script src="../js/carritoDes.js"></script>
    <a href="https://wa.me/5492612543607" target="_blank" class="whatsapp-float">
        <img src="../images/imageswhatsapp-icon.png" alt="WhatsApp">
    </a>
    <script src="/js/common.js"></script>

    <script>
        document.getElementById('comprar').addEventListener('click', function () {
            const hardcodedCartProducts = [
                { id: 1, title: 'Almohadón Ortopédico Deluxe - 70x50 cm', quantity: 1, unit_price: 9290, image: '../images/fotosProductos/Margarita-Photoroom.png' },
                { id: 2, title: 'Cojín Lumbar Ergonómico', quantity: 2, unit_price: 3500, image: 'https://via.placeholder.com/100/FF0000/FFFFFF?text=Cojin' },
                { id: 3, title: 'Funda de Almohada de Algodón Premium', quantity: 3, unit_price: 1200, image: 'https://via.placeholder.com/100/0000FF/FFFFFF?text=Funda' }
            ];
    
            const cartItemsToSend = hardcodedCartProducts.map(product => ({
                id: product.id,
                quantity: product.quantity
            }));
    
            if (cartItemsToSend.length === 0) {
                alert('Tu carrito está vacío. Agrega productos antes de continuar.');
                return;
            }
    
            // --- AÑADIR DATOS DEL CLIENTE AQUÍ (para pruebas) ---
            // En una aplicación real, estos datos vendrían de un formulario de checkout
            // o de la sesión del usuario logueado.
            const customerData = {
                full_name: "Cliente de Prueba Mauri",
                address: "Calle Falsa 123",
                city: "Mendoza",
                province: "Mendoza",
                phone: "2615551234",
                email: "hh.mauri2190@gmail.com", // Puedes usar tu correo de prueba aquí
                user_id: null // Si no tienes user_id por ahora, déjalo en null
            };
            // --- FIN: DATOS DEL CLIENTE ---
    
    
            fetch('http://localhost:3000/create_preference', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    items: cartItemsToSend,
                    ...customerData // Añade los datos del cliente al cuerpo de la solicitud
                }),
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message || 'Error desconocido al procesar la solicitud.');
                    }).catch(() => {
                        throw new Error(`Error HTTP: ${response.status} ${response.statusText}. Respuesta no es JSON.`);
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.init_point) {
                    window.location.href = data.init_point;
                } else {
                    alert('No se pudo generar la preferencia de pago.');
                }
            })
            .catch(error => {
                console.error('Error al iniciar el pago:', error);
                alert(`Ocurrió un error al procesar tu solicitud de pago: ${error.message}. Por favor, intenta de nuevo.`);
            });
        });
    </script>
</body>
</html>