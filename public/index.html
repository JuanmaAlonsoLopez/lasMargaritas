<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Las Margaritas</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Roboto:wght@400&family=Libre+Caslon+Display&family=Quintessential&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="./style/nuevo/nav-footer.css">

    <link rel="icon" href="./images/logoBanner/logo.png" type="image/png">
</head>

<body>
    
    <header id="mainHeader">
        <div class="header-inner">
            <div class="logo" id="logo">
                <a href="index.html">
                    <img src="./images/logoBanner/logoMargasNuevo.png" alt="Logo Las Margaritas">
                </a>
            </div>
            <nav class="main-nav" id="mainNav">
                <a class="activo" href="index.html">Inicio</a>
                <a href="./pages/categorias.html">Productos</a>
                <a href="./pages/sobreNosotros.html">Sobre nosotros</a>
                <a href="./pages/contacto.html">Contacto</a>
            </nav>
            <div class="icons" id="icons">
                <a href="#">
                    <img src="./images/logoBanner/account_circle_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg" alt="Ingresar">
                </a>
                <a href="#">
                    <img src="./images/logoBanner/shopping-cart_icon-icons.com_72552.svg" alt="Carrito">
                </a>
            </div>
        </div>
    </header>

    <div class="cart-dropdown" id="cartDropdown">
        <div class="cart-arrow"></div>
        <div class="cart-content">
            <h3>Productos en el carrito</h3>
            <div class="cart-items" id="cartItems"></div>
            <button onclick="location.href='./pages/ResumenCompra.html'" class="btn-go-cart">Ir al carrito</button>
        </div>
    </div>

    <nav class="menu-hamburguesa" id="menuHamburguesaResponsive">
        <a class="cerrar-menu" id="btnCerrarMenu" aria-label="Cerrar men√∫">√ó</a>
        <a href="index.html">INICIO</a>
        <a href="./pages/categorias.html">CATEGOR√çAS</a>
        <a href="./pages/listadoProductos.html">LISTADO DE PRODUCTOS</a>
        <a href="./pages/sobreNosotros.html">SOBRE NOSOTROS</a>
        <a href="./pages/contacto.html">CONTACTO</a>
        <a href="#"><img src="./images/logoBanner/account_circle_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg" alt="Ingresar"> INGRESAR</a>
    </nav>
    <div class="banner">
        <div class="carousel-item">
            <img src="./images/campoMargas.jpg" alt="Banner 1">
            <div class="carousel-text">
                <h2 class="lasMargas">Las Margaritas</h2>
                <p>Bienvenidos a nuestra tienda, donde la calidad es lo primero.</p>
            </div>
        </div>
    </div>

    <div class="textMedio">
        <h2>Contamos con una gran variedad de productos</h2>
        <span>De todo tipo, dise√±adas para ofrecer la m√°xima comodidad y soporte. Disponemos de almohadas ortop√©dicas, ideales para el cuidado de tu postura, almohadas suaves de confort para un descanso placentero, y tambi√©n almohadas especiales para beb√©s, que garantizan un sue√±o seguro y c√≥modo. Encuentra la opci√≥n perfecta para ti y tu familia.</span>
    </div>

    <div class="categoriaImg">
        <h2>Nuestras categor√≠as</h2>
        <div class="muestraCategorias">
            <div class="categoriaColumna">
                <a href="./pages/categorias.html">
                    <img src="./images/imgParaBanners/imgConfort.jpg" alt="Almohadas Confort" />
                    <p>Confort</p>
                </a>
            </div>
            <div class="categoriaColumna">
                <a href="./pages/categorias.html">
                    <img src="./images/imgParaBanners/imgOrtopedica.jpg" alt="Almohadas Ortop√©dicas" />
                    <p>Ortop√©dica</p>
                </a>
            </div>
            <div class="categoriaColumna">
                <a href="./pages/categorias.html">
                    <img src="./images/imgParaBanners/imgLineaBaby.jpg" alt="Almohadas Baby" />
                    <p>L√≠nea Baby</p>
                </a>
            </div>
        </div>
    </div>
    <section id="promotions-container">
        <h2>üî• ¬°Ofertas Imperdibles!</h2>
        <div class="productos">
            </div>
    </section>

    <main id="category-carousels-container">
        </main>
    <div class="productos-seccion">
        <div class="contenedor-productos">
            <div class="productoGrande1">
                <a href="./pages/confortPage.html">
                    <img src="./images/fotosEstetica/confort.png" alt="Confort" />
                </a>
            </div>
            <div class="segColumna">
                <div class="productoChico1">
                    <a href="./pages/lineaBaby.html"> 
                        <img src="./images/fotosEstetica/lineaBaby.png" alt="L√≠nea Baby" />
                    </a>
                </div>
                <div class="productoChico2">
                    <a href="./pages/ortopedica.html">
                        <img src="./images/fotosEstetica/ortopedica.png" alt="Ortop√©dicas" />
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="beneficios">
        <h2 class="prueba">Beneficios</h2>
        <div class="iconos-beneficios">
            <div class="beneficio">
                <img src="./images/conveniente.png" alt="Comodidad" />
                <p class="tipoBeneficio">Comodidad</p>
            </div>
            <div class="beneficio">
                <img src="./images/diagrama.png" alt="Mejor Sue√±o" />
                <p class="tipoBeneficio">Mejor Sue√±o</p>
            </div>
            <div class="beneficio">
                <img src="./images/calidad.png" alt="Material de Calidad" />
                <p class="tipoBeneficio">Material de calidad</p>
            </div>
        </div>
    </div>

    <div class="banner-ortopedicas">
        <div class="texto">
            <h2>Descubre el confort y soporte<br>que tu cuerpo necesita</h2>
            <button class="ver-mas" onclick="location.href='/pages/ortopedica.html'">Ver productos</button>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-grid">
            <div class="footer-right">
                <img src="./images/logoBanner/logoMargasNuevo.png" alt="Logo Las Margaritas" class="footer-logo">
                <p class="footer-desc">F√°brica de productos de confort</p>
                <div class="socialMedia">
                    <a href="https://www.instagram.com/almohadones.lasmargaritas" target="_blank" rel="noopener">
                        <img src="./images/logotipo-de-instagram.png" alt="Instagram">
                    </a>
                </div>
            </div>
            <div class="footer-center">
                <span>Avda. Juan B. Justo 8667</span>
                <span>CABA, Argentina</span>
                <span>Tel√©fono: 11 3437-4127</span>
                <span>Email: info@lasmargaritas.online</span>
            </div>
            <div class="footer-left">
                <a href="./pages/contacto.html"><span>Contacto</span></a>
                <a href="./pages/sobreNosotros.html"><span>Sobre Nosotros</span></a>
                <a href="#"><span>Otro</span></a>
            </div>  
        </div>
        <div class="footer-bottom">
            <p>Todos los derechos reservados &copy; Las Margaritas 2025</p>
        </div>
    </footer>
    <a href="https://wa.me/5491134374127" target="_blank" class="whatsapp-float" rel="noopener">
        <img src="./images/imageswhatsapp-icon.png" alt="WhatsApp">
    </a>

    <script src="carousel.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/carritoDes.js"></script>
    <script src="/js/common.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_BASE_URL = 'http://127.0.0.1:3000';
            const mainPromotionsContainer = document.querySelector('#promotions-container .productos');
            const categoryCarouselsContainer = document.getElementById('category-carousels-container');
    
            /**
             * Crea el HTML para una tarjeta de producto.
             */
            function createProductHtml(product) {
                let priceHtml = `<p class="precio">$${product.price}</p>`;
                if (product.promotion_active && product.discount_value > 0) {
                    const discountedPrice = product.price * (1 - product.discount_value / 100);
                    priceHtml = `
                        <p class="precio-original">$${product.price}</p>
                        <p class="precio-oferta">$${discountedPrice.toFixed(2)} <span class="descuento">-${product.discount_value}%</span></p>
                    `;
                }
                return `
                    <div class="producto" data-id="${product.id}">
                        <img src="${product.image_url}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>${product.description}</p>
                        ${priceHtml}
                        <p>Stock: ${product.stock}</p>
                        <button class="agregar-carrito">Agregar al carrito</button>
                    </div>
                `;
            }
    
            /**
             * Busca productos y los renderiza en un contenedor.
             */
            async function fetchAndRenderProducts(container, category = null) {
                if (!container) return;
                container.innerHTML = '<p>Cargando productos...</p>';
    
                try {
                    let url = `${API_BASE_URL}/api/products`;
                    if (category) {
                        url += `?category=${encodeURIComponent(category)}`;
                    }
    
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }
                    const products = await response.json();
    
                    if (products.length > 0) {
                        container.innerHTML = products.map(createProductHtml).join('');
                    } else {
                        container.innerHTML = '<p>No hay productos disponibles en esta categor√≠a.</p>';
                    }
                } catch (error) {
                    console.error(`Error al cargar productos para la categor√≠a "${category || 'promociones'}":`, error);
                    container.innerHTML = '<p>Error al cargar productos. Por favor, int√©ntalo de nuevo m√°s tarde.</p>';
                }
            }
    
            /**
             * Funci√≥n principal para inicializar la p√°gina.
             */
            async function initializePage() {
                // 1. Cargar el carrusel principal de todas las promociones.
                fetchAndRenderProducts(mainPromotionsContainer, null);
    
                // 2. Obtener la lista de categor√≠as activas desde el backend.
                try {
                    const response = await fetch(`${API_BASE_URL}/api/categories`);
                    if (!response.ok) throw new Error('No se pudieron obtener las categor√≠as.');
                    
                    const activeCategories = await response.json();
    
                    // 3. Crear un carrusel para CADA categor√≠a recibida.
                    activeCategories.forEach(categoryName => {
                        const categorySection = document.createElement('section');
                        categorySection.className = 'productos-destacados'; // Reutilizamos la clase para mantener el estilo
                        
                        const title = document.createElement('h2');
                        title.textContent = categoryName;
    
                        const productsContainer = document.createElement('div');
                        productsContainer.className = 'productos';
                        
                        categorySection.appendChild(title);
                        categorySection.appendChild(productsContainer);
    
                        categoryCarouselsContainer.appendChild(categorySection);
    
                        fetchAndRenderProducts(productsContainer, categoryName);
                    });
    
                } catch (error) {
                    console.error('Error al inicializar los carruseles de categor√≠as:', error);
                    if (categoryCarouselsContainer) {
                        categoryCarouselsContainer.innerHTML = '<p>No se pudieron cargar las categor√≠as de productos.</p>';
                    }
                }
            }
    
            // Iniciar la carga de contenido.
            initializePage();
        });
    </script>
</body>
</html>